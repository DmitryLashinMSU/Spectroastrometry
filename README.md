# Spectroastrometry
В репозитории содержится <strong><a href="./Spectroastrometry.py">модуль</a></strong> на языке Python, содержащий набор функций для спектроастрометрической обработки данных, а также <strong><a href="./Example/Example.ipynb">образец</a></strong> его применения. Идея метода описана в работе [Whelan & Garcia 2008](https://ui.adsabs.harvard.edu/abs/2008LNP...742..123W/abstract). 

## Быстрый старт
Просто поместите файл `Spectroastrometry.py` в директорию с вашим Python-проектом и подключите его как обычную библиотеку `Spectroastrometry`.

## Документация
Ниже приведен список функций модуля, их описание и параметры.

---

### `G_fit`
Аппроксимация "положительной" гауссовой функцией для профиля интенсивности.

**Аргументы:**
| Параметр | Описание |
|----------|----------|
| `coord`  | Массив координат (пиксели) |
| `I`      | Массив интенсивностей (ADU) |

**Возвращает:**
- `P` — массив параметров модели:  
  `P[0]` — интеграл интенсивности,  
  `P[1]` — стандартное отклонение,  
  `P[2]` — положение центра,  
  `P[3]` — фон.

**Примечание:**  
Использует функцию ошибок `erf` для моделирования дискретного гауссова профиля.

---

### `neg_G_fit`
Аппроксимация "отрицательной" гауссовой функцией (для линий поглощения).

**Аргументы:**
| Параметр | Описание |
|----------|----------|
| `coord`  | Массив координат (пиксели) |
| `I`      | Массив интенсивностей (ADU) |

**Возвращает:**
- `P` — массив параметров модели (аналогично `G_fit`, но для поглощения).

---

### `Center_search`
Вычисление наблюдаемого смещения и FWHM вдоль спектрального среза для всех точек спектра вдоль направления дисперсии.

**Аргументы:**
| Параметр   | Описание |
|------------|----------|
| `CRVAL1`   | Начальное значение длины волны спектра (λ) |
| `CDELT1`   | Дисперсия (Δλ/пиксель) |
| `x_start`  | Начальный пиксель по X |
| `x_end`    | Конечный пиксель по X |
| `area`     | Полуширина выделенной для анализа области по Y |
| `Y_est`    | Предполагаемый центр спектра по Y |
| `image`    | 2D массив изображения |

**Возвращает:**
- `LAMBDA`   — массив длин волн
- `SPEC`     — спектр (сумма по Y в выделенной области)
- `CENTER`   — координаты центра по Y для каждого X
- `FWHM`     — ширина на полувысоте для каждого X
- `ERRORBAR` — погрешность определения центра

**Примечание:**  
Погрешность вычисляется согласно [Condon, 1977](https://ui.adsabs.harvard.edu/abs/1997PASP..109..166C/abstract) по формуле:

$$
\delta = 0.6 \frac{FWHM}{SNR},
$$

где $FWHM$ — полуширина спектра, $SNR$ — отношение сигнал/шум.

---

### `LCS_auto`
Оценка истинного смещения на основе спектральной линии (автоматический поиск центра линии). Для этого вычисляются профили яркости спектра в области максимума выбранной линии, а также с некоторым отступом от нее (там, где присутствует только континуум). Вычитая континуум, можно получить чистый профиль линии, центр которого соответствует истинной позиции источника, излучающего в этой линии.

**Аргументы:**
| Параметр    | Описание |
|-------------|----------|
| `CRVAL1`    | Начальное значение λ |
| `CDELT1`    | Дисперсия (Δλ/пиксель) |
| `image`     | 2D изображение |
| `LAMBDA`    | Массив длин волн (от `Center_search`) |
| `SPEC`      | Спектр (от `Center_search`) |
| `x_start`   | Начало линии (пиксель) |
| `x_end`     | Конец линии (пиксель) |
| `x_cont`    | X-координата точки, выбранной для определения континуума |
| `Y_est`     | Предполагаемый центр по Y |
| `area`      | Полуширина области по Y |
| `Line_type` | Тип линии: `'emission'` или `'absorption'` |

**Возвращает:**
- `P4` — параметры модели линии после вычитания континуума
- Положение центра линии в пикселях

---

### `LCS_target`
Оценка истинного смещения на основе линии с заданным вручную центром.

**Аргументы:**
| Параметр | Описание |
|----------|----------|
| `image`  | 2D изображение |
| `x_line` | Пиксель центра линии |
| `x_cont` | Пиксель для континуума |
| `Y_est`  | Предполагаемый центр по Y |
| `area`   | Полуширина области по Y |

**Возвращает:**
- `P4` — параметры модели линии
- `P3` — параметры фона (континуума)

---

### `Median_images`
Медианная обработка набора изображений.

**Аргументы:**
| Параметр  | Описание |
|-----------|----------|
| `images`  | Список 2D массивов одинакового размера |

**Возвращает:**
- `median_image` — медианное изображение

---

### `Average_images`
Усреднение набора изображений.

**Аргументы:**
| Параметр  | Описание |
|-----------|----------|
| `images`  | Список 2D массивов одинакового размера |

**Возвращает:**
- `average_image` — усреднённое изображение

---

### `Detrend`
Устранение тренда методом скользящего среднего.

**Аргументы:**
| Параметр  | Описание |
|-----------|----------|
| `window`  | Ширина окна для скользящего среднего |
| `CENTER`  | Массив значений центров |

**Возвращает:**
- `CENTER_rolling` — центры после удаления тренда
- `rolling_mean`   — скользящее среднее

---

### `remove_polynomial_trend`
Устранение полиномиального тренда n-й степени.

**Аргументы:**
| Параметр | Описание |
|----------|----------|
| `data`   | 2D массив данных (например, `CENTER`) |
| `n`      | Степень полинома |

**Возвращает:**
- `detrended_data` — данные без тренда

---

### `show_3D`
Построение 3D-графика выбранной области изображения.

**Аргументы:**
| Параметр  | Описание |
|-----------|----------|
| `image`   | 2D изображение |
| `x_start` | Начало по X |
| `x_end`   | Конец по X |
| `y_start` | Начало по Y |
| `y_end`   | Конец по Y |

---

## Зависимости
- `numpy`
- `matplotlib`
- `scipy` (least_squares, erf)

---

>Мои контакты: [lashinda@my.msu.ru](mailto:lashinda@my.msu.ru)
